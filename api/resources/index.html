<form id="spotForm">
  <label>Company or Ticker</label>
  <input id="q" required />
  <label>Horizon (years)</label>
  <input id="yrs" type="number" min="1" max="20" value="10" required />
  <label><input id="em" type="checkbox" checked /> Email me this report</label>
  <button type="submit">Create Spotlight Report</button>
</form>

<div id="result" style="margin-top:16px;display:none">
  <div>
    <a id="dl" download>Download</a>
    <a id="open" target="_blank" rel="noreferrer">Open</a>
  </div>
  <iframe id="frame" style="width:100%;height:80vh;border:0"></iframe>
</div>

<script>
const USER_ID = window.USER_ID || "demo-user";
document.getElementById("spotForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const body = {
    query: document.getElementById("q").value.trim(),
    years: Number(document.getElementById("yrs").value),
    user_id: USER_ID,
    email_opt_in: document.getElementById("em").checked
  };
  const r = await fetch("/api/spotlight", {method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify(body)});
  const j = await r.json();
  if (!r.ok) { alert("Failed:\n" + (j.details?.join("\n") || j.error)); return; }
  document.getElementById("result").style.display = "block";
  document.getElementById("frame").src = j.url;
  document.getElementById("dl").href = j.url;
  document.getElementById("open").href = j.url;
});
</script>
